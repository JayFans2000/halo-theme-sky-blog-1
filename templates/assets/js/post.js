import"./chunks/article-content-CjRqbsg3.js";import{a as x,b as C,c as L,s as E}from"./chunks/toc-utils-BLHN02M0.js";document.addEventListener("alpine:init",()=>{Alpine.data("articleExcerpt",()=>({typing:!0,text:"",fullText:"",charIndex:0,typingSpeed:50,init(){const c=this.$refs.excerptText;c&&(this.fullText=c.dataset.text||"",this.startTyping())},startTyping(){if(this.charIndex<this.fullText.length){this.text+=this.fullText.charAt(this.charIndex),this.$refs.excerptText.textContent=this.text,this.charIndex++;const c=this.fullText.charAt(this.charIndex-1);let t=this.typingSpeed;"，。！？、；：".includes(c)?t=200:",.!?;:".includes(c)&&(t=150),setTimeout(()=>this.startTyping(),t)}else setTimeout(()=>{this.typing=!1},500)}})),Alpine.data("postLike",()=>({isLiked:!1,likeCount:0,postName:"",init(){const c=this.$el.closest("[data-post-name]");c&&(this.postName=c.dataset.postName||"",this.likeCount=parseInt(c.dataset.upvoteCount||"0"),this.checkLikeStatus())},checkLikeStatus(){if(!this.postName)return;const c=JSON.parse(localStorage.getItem("halo.upvoted.post.names")||"[]");this.isLiked=c.includes(this.postName)},async toggleLike(){if(this.postName&&!this.isLiked)try{const c=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:"content.halo.run",plural:"posts",name:this.postName})});if(c.ok){this.isLiked=!0,this.likeCount+=1;const t=JSON.parse(localStorage.getItem("halo.upvoted.post.names")||"[]");t.includes(this.postName)||(t.push(this.postName),localStorage.setItem("halo.upvoted.post.names",JSON.stringify(t)))}else{const t=await c.text()}}catch{}}})),Alpine.data("postComment",()=>({commentCount:0,init(){const c=this.$el.closest("[data-comment-count]");c&&(this.commentCount=parseInt(c.dataset.commentCount||"0"))},toggleCommentDrawer(){const c=document.getElementById("comment-drawer");c&&(c.checked=!c.checked)}}))});(function(){const c={init(){this.initWordCount(),this.initHeadingAnchors(),this.initTOC(),this.initReadingProgress(),this.initCodeCopy(),this.initScrollToTop(),this.initTocDrawer()},initTocDrawer(){const t=document.getElementById("post-toc-overlay"),o=document.getElementById("post-toc-drawer"),n=document.getElementById("post-toc-drawer-nav");!t||!o||(window.openPostTocDrawer=()=>{t.classList.add("open"),o.classList.add("open"),document.body.style.overflow="hidden",n&&!n.querySelector(".toc-list")&&this.initTocDrawerContent(n)},window.closePostTocDrawer=()=>{t.classList.remove("open"),o.classList.remove("open"),document.body.style.overflow=""},document.addEventListener("keydown",e=>{e.key==="Escape"&&o.classList.contains("open")&&window.closePostTocDrawer()}))},initTocDrawerContent(t){const o=document.getElementById("toc-nav");if(o&&o.innerHTML.trim()){t.innerHTML=o.innerHTML,this.bindTocDrawerEvents(t);return}const n=document.getElementById("article-content");if(!n){t.innerHTML='<p class="text-base-content/50 text-sm">暂无目录</p>';return}const e=n.querySelectorAll("h1, h2, h3, h4, h5, h6");if(e.length===0){t.innerHTML='<p class="text-base-content/50 text-sm">暂无目录</p>';return}const s=Array.from(e),i=s.map(d=>parseInt(d.tagName.charAt(1))),a=Math.min(...i),l=document.createElement("ol");l.className="toc-list",s.forEach((d,m)=>{d.id||(d.id=`heading-${m}`);const h=parseInt(d.tagName.charAt(1))-a,p=document.createElement("li");p.className="toc-item-wrapper",p.style.setProperty("--toc-indent-multiplier",h.toString());const r=document.createElement("a");r.href=`#${d.id}`,r.textContent=d.textContent.trim(),r.className="toc-link",r.setAttribute("data-heading-id",d.id),p.appendChild(r),l.appendChild(p)}),t.appendChild(l),this.bindTocDrawerEvents(t)},bindTocDrawerEvents(t){t.querySelectorAll(".toc-link").forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();const s=n.getAttribute("data-heading-id")||n.getAttribute("href").slice(1),i=document.getElementById(s);i&&(window.closePostTocDrawer(),setTimeout(()=>{window.scrollTo({top:i.offsetTop-80,behavior:"smooth"})},100))})})},initHeadingAnchors(){const t=document.getElementById("article-content");if(!t)return;t.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]").forEach(n=>{const e=n.getAttribute("id");if(!e)return;n.style.position="relative",n.style.cursor="pointer";const s=document.createElement("a");s.href=`#${e}`,s.className="heading-anchor",s.innerHTML='<span class="icon-[heroicons--link] w-4 h-4"></span>',s.setAttribute("aria-label","复制链接"),s.style.cssText=`
                    position: absolute;
                    left: -1.5em;
                    top: 50%;
                    transform: translateY(-50%);
                    opacity: 0;
                    transition: opacity 0.2s ease;
                    color: var(--color-primary);
                    text-decoration: none;
                    display: inline-flex;
                    align-items: center;
                `,n.addEventListener("mouseenter",()=>{s.style.opacity="1"}),n.addEventListener("mouseleave",()=>{s.style.opacity="0"}),s.addEventListener("click",async i=>{i.preventDefault();const a=window.location.origin+window.location.pathname+`#${e}`;try{await navigator.clipboard.writeText(a),s.innerHTML='<span class="icon-[heroicons--check] w-4 h-4"></span>',setTimeout(()=>{s.innerHTML='<span class="icon-[heroicons--link] w-4 h-4"></span>'},2e3)}catch{}}),n.insertBefore(s,n.firstChild)})},initTOC(){const t=document.getElementById("toc-nav"),o=document.getElementById("toc-card");if(!t)return;const n=document.getElementById("article-content");if(!n){o&&(o.style.display="none");return}const e=n.querySelectorAll("h1, h2, h3, h4, h5, h6");if(e.length===0){o&&(o.style.display="none");return}const s=x(e);if(s.filteredHeadings.length===0){o&&(o.style.display="none");return}o&&(o.style.display="block");const i=C(s.filteredHeadings,s.minLevel),a=L(i,{addTooltip:!0,onClick:l=>E(l,80)});t.innerHTML="",t.appendChild(a),this.initTocScrollHighlight(s.filteredHeadings),this.initAdaptiveLayout()},initAdaptiveLayout(){document.querySelector(".toc-container")&&(window.ResizeObserver&&new ResizeObserver(()=>{this.updateTocLayout()}).observe(document.documentElement),window.addEventListener("resize",()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.updateTocLayout()},150)}),this.updateTocLayout())},updateTocLayout(){const t=document.querySelector(".toc-container");if(!t)return;const o=document.getElementById("toc-nav");if(!o)return;const n=o.scrollHeight,e=parseFloat(getComputedStyle(t).maxHeight),s=n>e;t.classList.toggle("has-scroll",s)},initTocScrollHighlight(t){let o=!1;const n=()=>{const s=window.scrollY+120,i=window.innerHeight,a=document.documentElement.scrollHeight;let l=-1;s+i>=a-50?l=t.length-1:t.forEach((d,m)=>{const u=d.offsetTop,h=t[m+1],p=h?h.offsetTop:a;u<=s&&s<p&&(l=m)}),this.updateTocHighlight(l),o=!1},e=()=>{o||(requestAnimationFrame(n),o=!0)};window.addEventListener("scroll",e,{passive:!0}),n()},updateTocHighlight(t){document.querySelectorAll(".toc-link").forEach((n,e)=>{if(e===t){n.classList.add("active");const s=document.querySelector(".toc-container");s&&this.scrollToActiveItem(s,n)}else n.classList.remove("active")})},scrollToActiveItem(t,o){const n=t.scrollTop,e=t.clientHeight,s=t.scrollHeight;let i=0,a=o;for(;a&&a!==t&&(i+=a.offsetTop,a=a.offsetParent,a!==t););if(a!==t){const r=t.getBoundingClientRect().top+window.scrollY;i=o.getBoundingClientRect().top+window.scrollY-r+t.scrollTop}const l=o.offsetHeight,d=n,m=n+e,u=i,h=i+l;if(!(u>=d&&h<=m)){let r;const g=Math.max(0,s-e),f=0,T=e/2-l/2;r=i-T,r<f?i<e/3?r=f:r=Math.max(f,i-40):r>g&&(s-i-l<e/3?r=g:r=Math.min(g,i-e+l+40)),h<d?d-h>e?r=Math.max(f,i-T):r=Math.max(f,i-20):u>m&&(u-m>e?r=Math.min(g,i-T):r=Math.min(g,i-e+l+20));const w=t.scrollTop,v=Math.abs(r-w);if(v>5){const y=v>e?"auto":"smooth";t.scrollTo({top:r,behavior:y})}}},initReadingProgress(){const t=document.getElementById("reading-progress");if(!t)return;let o=!1;const n=()=>{const s=document.documentElement.scrollHeight-window.innerHeight,i=window.scrollY/s*100;t.style.width=`${Math.min(i,100)}%`,o=!1},e=()=>{o||(requestAnimationFrame(n),o=!0)};window.addEventListener("scroll",e,{passive:!0})},initCodeCopy(){document.querySelectorAll("pre code").forEach(o=>{const n=o.parentElement;if(!n)return;const e=document.createElement("button");e.className="absolute top-2 right-2 px-3 py-1 bg-base-200 hover:bg-base-300 rounded text-sm transition-colors",e.textContent="复制",e.setAttribute("aria-label","复制代码"),n.style.position="relative",n.appendChild(e),e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o.textContent),e.textContent="已复制",e.classList.add("bg-success","text-success-content"),setTimeout(()=>{e.textContent="复制",e.classList.remove("bg-success","text-success-content")},2e3)}catch{e.textContent="复制失败",setTimeout(()=>{e.textContent="复制"},2e3)}})})},initWordCount(){const t=document.getElementById("article-content"),o=document.getElementById("word-count"),n=document.getElementById("reading-time");if(!t||!o||!n)return;const e=t.cloneNode(!0);e.querySelectorAll("pre").forEach(r=>r.remove());const i=e.textContent||e.innerText||"",l=(i.match(/[\u4e00-\u9fa5]/g)||[]).length,u=(i.replace(/[\u4e00-\u9fa5]/g," ").match(/[a-zA-Z]+/g)||[]).length,h=l+u,p=Math.ceil(l/300+u/200);o.textContent=h.toLocaleString(),n.textContent=Math.max(1,p)},initScrollToTop(){const t=document.getElementById("scroll-to-top");if(!t)return;let o=!1;const n=()=>{window.scrollY>300?(t.classList.remove("opacity-0","pointer-events-none"),t.classList.add("opacity-100")):(t.classList.add("opacity-0","pointer-events-none"),t.classList.remove("opacity-100")),o=!1},e=()=>{o||(requestAnimationFrame(n),o=!0)};window.addEventListener("scroll",e,{passive:!0}),t.addEventListener("click",()=>{"scrollBehavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0)})}};document.addEventListener("DOMContentLoaded",()=>{c.init()})})();
