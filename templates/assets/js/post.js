class t{constructor(){this.tocContainer=null,this.tocList=null,this.mobileTocToggle=null,this.mobileTocDrawer=null,this.mobileTocOverlay=null,this.mobileTocClose=null,this.progressBar=null,this.headings=[],this.currentActiveId=null,this.isScrolling=!1,this.scrollTimeout=null,this.isMobileTocOpen=!1,this.init()}init(){this.initElements(),this.generateTOC(),this.initMobileTOC(),this.initReadingProgress(),this.initCodeCopyButtons(),this.initLikeButton(),this.initShareButtons(),this.initScrollToTop(),this.bindEvents();let t=!1;window.addEventListener("scroll",()=>{t||(requestAnimationFrame(()=>{this.updateActiveTOCItem(),t=!1}),t=!0)})}initElements(){this.tocContainer=document.querySelector(".toc-sidebar"),this.tocList=document.querySelector(".toc-list"),this.progressBar=document.querySelector(".reading-progress-fill"),this.mobileTocToggle=document.querySelector(".mobile-toc-toggle"),this.mobileTocDrawer=document.querySelector(".mobile-toc-drawer"),this.mobileTocOverlay=document.querySelector(".mobile-toc-overlay"),this.mobileTocClose=document.querySelector(".mobile-toc-close"),this.headings=Array.from(document.querySelectorAll(".post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6"))}generateTOC(){if(!this.tocList||0===this.headings.length)return this.tocContainer&&(this.tocContainer.style.display="none"),void(this.mobileTocToggle&&(this.mobileTocToggle.style.display="none"));this.tocList.innerHTML="";const t=this.buildTOCStructure();this.renderTOCStructure(t,this.tocList),this.generateMobileTOC(t)}buildTOCStructure(){const t=[],e=[];return this.headings.forEach((o,s)=>{const n=o.id||`heading-${s}`;o.id=n;const i=parseInt(o.tagName.charAt(1)),r={id:n,text:o.textContent.trim(),level:i,element:o,children:[]};for(;e.length>0&&e[e.length-1].level>=i;)e.pop();0===e.length?t.push(r):e[e.length-1].children.push(r),e.push(r)}),t}renderTOCStructure(t,e){t.forEach(t=>{const o=document.createElement("li");o.className="toc-item";const s=document.createElement("a");if(s.href=`#${t.id}`,s.textContent=t.text,s.className=`toc-link toc-level-${t.level}`,s.dataset.target=t.id,s.dataset.level=t.level,o.appendChild(s),t.children.length>0){const e=document.createElement("ul");e.className="toc-sublist",this.renderTOCStructure(t.children,e),o.appendChild(e)}e.appendChild(o)})}generateMobileTOC(t){const e=this.mobileTocDrawer?.querySelector(".toc-list");e&&(e.innerHTML="",this.renderTOCStructure(t,e))}initMobileTOC(){this.mobileTocToggle&&this.mobileTocDrawer&&this.mobileTocOverlay&&(this.mobileTocToggle.addEventListener("click",()=>{this.toggleMobileTOC()}),this.mobileTocClose&&this.mobileTocClose.addEventListener("click",()=>{this.closeMobileTOC()}),this.mobileTocOverlay.addEventListener("click",()=>{this.closeMobileTOC()}),this.mobileTocDrawer.addEventListener("click",t=>{if(t.target.classList.contains("toc-link")){t.preventDefault();const e=t.target.dataset.target;this.scrollToHeading(e),this.closeMobileTOC()}}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isMobileTocOpen&&this.closeMobileTOC()}))}toggleMobileTOC(){this.isMobileTocOpen?this.closeMobileTOC():this.openMobileTOC()}openMobileTOC(){this.isMobileTocOpen=!0,this.mobileTocDrawer.classList.add("open"),this.mobileTocOverlay.classList.add("open"),document.body.style.overflow="hidden"}closeMobileTOC(){this.isMobileTocOpen=!1,this.mobileTocDrawer.classList.remove("open"),this.mobileTocOverlay.classList.remove("open"),document.body.style.overflow=""}initReadingProgress(){if(!this.progressBar)return;const t=()=>{const t=document.querySelector(".post-content");if(!t)return;const e=t.offsetTop,o=t.offsetHeight,s=window.pageYOffset||document.documentElement.scrollTop,n=window.innerHeight,i=e-.3*n,r=e+o-.7*n-i;let a=0;s>i&&(a=Math.min(100,(s-i)/r*100)),this.progressBar.style.width=`${Math.max(0,a)}%`};t();let e=!1;window.addEventListener("scroll",()=>{e||(requestAnimationFrame(()=>{t(),e=!1}),e=!0)})}initCodeCopyButtons(){document.querySelectorAll('pre[class*="language-"]').forEach(t=>{const e=document.createElement("button");e.className="code-copy-btn",e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',e.setAttribute("aria-label","复制代码"),e.setAttribute("title","复制代码"),e.addEventListener("click",async()=>{const o=t.querySelector("code");if(o)try{await navigator.clipboard.writeText(o.textContent),e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"></polyline></svg>',e.classList.add("copied"),e.setAttribute("title","已复制"),setTimeout(()=>{e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',e.classList.remove("copied"),e.setAttribute("title","复制代码")},2e3)}catch(s){console.error("复制失败:",s),e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',e.setAttribute("title","复制失败"),setTimeout(()=>{e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2 2v1"></path></svg>',e.setAttribute("title","复制代码")},2e3)}}),t.style.position="relative",t.appendChild(e)})}async copyCodeToClipboard(t,e){const o=t.querySelector("code");if(o)try{await navigator.clipboard.writeText(o.textContent);const t=e.textContent;e.textContent="已复制",e.classList.add("copied"),setTimeout(()=>{e.textContent=t,e.classList.remove("copied")},2e3)}catch(s){console.error("复制失败:",s),this.fallbackCopyTextToClipboard(o.textContent,e)}}fallbackCopyTextToClipboard(t,e){const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy");const t=e.textContent;e.textContent="已复制",e.classList.add("copied"),setTimeout(()=>{e.textContent=t,e.classList.remove("copied")},2e3)}catch(s){console.error("降级复制也失败了:",s)}document.body.removeChild(o)}initLikeButton(){const t=document.querySelector(".like-btn");if(!t)return;const e=this.getPostId();"true"===localStorage.getItem(`post-liked-${e}`)&&t.classList.add("liked"),t.addEventListener("click",o=>{o.preventDefault(),this.toggleLike(t,e)})}toggleLike(t,e){const o=t.classList.contains("liked"),s=t.querySelector(".like-count");if(o){if(t.classList.remove("liked"),localStorage.removeItem(`post-liked-${e}`),s){const t=parseInt(s.textContent)||0;s.textContent=Math.max(0,t-1)}}else if(t.classList.add("liked"),localStorage.setItem(`post-liked-${e}`,"true"),s){const t=parseInt(s.textContent)||0;s.textContent=t+1}t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform=""},150)}initShareButtons(){document.querySelectorAll(".share-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const o=t.dataset.platform;this.shareToSocial(o)})})}shareToSocial(t){const e=encodeURIComponent(window.location.href),o=encodeURIComponent(document.title);let s="";switch(t){case"weibo":s=`https://service.weibo.com/share/share.php?url=${e}&title=${o}`;break;case"qq":s=`https://connect.qq.com/widget/shareqq/index.html?url=${e}&title=${o}`;break;case"copy":return void this.copyToClipboard(window.location.href);default:return}s&&window.open(s,"_blank","width=600,height=400")}async copyToClipboard(t){try{await navigator.clipboard.writeText(t),this.showToast("链接已复制到剪贴板")}catch(e){console.error("复制失败:",e),this.showToast("复制失败，请手动复制")}}showToast(t){const e=document.createElement("div");e.className="toast-message",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.classList.add("show")},10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{document.body.removeChild(e)},300)},3e3)}initScrollToTop(){const t=document.createElement("button");t.className="scroll-to-top btn btn-circle btn-primary fixed bottom-8 right-8 z-50 opacity-0 transition-all duration-300",t.innerHTML="↑",t.setAttribute("aria-label","返回顶部"),document.body.appendChild(t),window.addEventListener("scroll",()=>{window.pageYOffset>300?(t.style.opacity="1",t.style.pointerEvents="auto"):(t.style.opacity="0",t.style.pointerEvents="none")}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}bindEvents(){this.tocList&&this.tocList.addEventListener("click",t=>{if("A"===t.target.tagName){t.preventDefault();const e=t.target.dataset.target;this.scrollToHeading(e)}});let t=!1;window.addEventListener("scroll",()=>{t||(requestAnimationFrame(()=>{this.updateActiveTOCItem(),t=!1}),t=!0)}),window.addEventListener("resize",()=>{clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.updateActiveTOCItem()},250)})}scrollToHeading(t){const e=document.getElementById(t);if(!e)return;const o=e.offsetTop-100;this.isScrolling=!0,window.scrollTo({top:o,behavior:"smooth"}),setTimeout(()=>{this.isScrolling=!1},1e3)}updateActiveTOCItem(){if(this.isScrolling||!this.tocList)return;const t=window.pageYOffset||document.documentElement.scrollTop;let e=null;for(let o=this.headings.length-1;o>=0;o--){const s=this.headings[o];if(t>=s.offsetTop-150){e=s.id;break}}if(e!==this.currentActiveId){const t=this.tocList.querySelector(".active");if(t&&t.classList.remove("active"),e){const t=this.tocList.querySelector(`[data-target="${e}"]`);t&&t.classList.add("active")}this.currentActiveId=e}}getPostId(){const t=document.querySelector("[data-post-id]");if(t)return t.dataset.postId;const e=window.location.pathname.split("/");return e[e.length-1]||"unknown"}}class e{constructor(){this.images=[],this.observer=null,this.init()}init(){this.images=Array.from(document.querySelectorAll("img[data-src]")),"IntersectionObserver"in window?(this.observer=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&this.loadImage(t.target)})},{rootMargin:"50px 0px"}),this.images.forEach(t=>{this.observer.observe(t)})):this.images.forEach(t=>{this.loadImage(t)})}loadImage(t){const e=t.dataset.src;e&&(t.src=e,t.classList.add("loaded"),this.observer&&this.observer.unobserve(t))}}class o{constructor(){this.container=null,this.currentPostId=null,this.currentTags=[],this.currentCategory=null,this.relatedPosts=[],this.init()}init(){this.container=document.querySelector(".related-posts"),this.container&&(this.extractCurrentPostInfo(),this.loadRelatedPosts())}extractCurrentPostInfo(){const t=document.querySelector("[data-post-id]");this.currentPostId=t?t.dataset.postId:null;const e=document.querySelectorAll(".post-tags .tag");this.currentTags=Array.from(e).map(t=>t.textContent.trim());const o=document.querySelector(".post-category");this.currentCategory=o?o.textContent.trim():null}async loadRelatedPosts(){try{this.relatedPosts=this.generateMockRelatedPosts(),this.renderRelatedPosts()}catch(t){console.error("加载相关文章失败:",t),this.showErrorMessage()}}generateMockRelatedPosts(){return[{id:"post-1",title:"Vue 3 Composition API 深度解析",excerpt:"深入了解 Vue 3 的 Composition API，掌握现代 Vue 开发的核心概念和最佳实践。",thumbnail:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=Vue.js%20logo%20with%20modern%20code%20editor%20interface%20clean%20tech%20style&image_size=landscape_4_3",category:"前端开发",tags:["Vue.js","JavaScript","Web开发"],publishDate:"2024-01-15",readTime:"8 分钟",views:1250},{id:"post-2",title:"TypeScript 高级类型系统实战",excerpt:"探索 TypeScript 的高级类型特性，提升代码质量和开发效率的实用技巧。",thumbnail:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=TypeScript%20logo%20with%20code%20syntax%20highlighting%20professional%20developer%20workspace&image_size=landscape_4_3",category:"编程语言",tags:["TypeScript","JavaScript","类型系统"],publishDate:"2024-01-12",readTime:"12 分钟",views:980},{id:"post-3",title:"现代 CSS 布局技术全解",excerpt:"Grid、Flexbox、Container Queries 等现代 CSS 布局技术的完整指南。",thumbnail:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=CSS%20grid%20flexbox%20layout%20design%20colorful%20geometric%20patterns%20modern%20web%20design&image_size=landscape_4_3",category:"前端开发",tags:["CSS","Web设计","响应式"],publishDate:"2024-01-10",readTime:"15 分钟",views:1580}]}renderRelatedPosts(){const t=this.container.querySelector(".related-posts-grid");t&&(t.innerHTML="",this.relatedPosts.forEach(e=>{const o=this.createPostElement(e);t.appendChild(o)}),this.animatePostsAppearance())}createPostElement(t){const e=document.createElement("article");return e.className="related-post-card group cursor-pointer",e.dataset.postId=t.id,e.innerHTML=`\n      <div class="related-post-thumbnail">\n        <img \n          src="${t.thumbnail}" \n          alt="${t.title}"\n          class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105"\n          loading="lazy"\n        />\n        <div class="related-post-overlay">\n          <span class="category-badge">${t.category}</span>\n        </div>\n      </div>\n      \n      <div class="related-post-content">\n        <h3 class="related-post-title">${t.title}</h3>\n        <p class="related-post-excerpt">${t.excerpt}</p>\n        \n        <div class="related-post-tags">\n          ${t.tags.map(t=>`<span class="tag tag-sm">${t}</span>`).join("")}\n        </div>\n        \n        <div class="related-post-meta">\n          <div class="meta-item">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>\n            </svg>\n            <span>${this.formatDate(t.publishDate)}</span>\n          </div>\n          \n          <div class="meta-item">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n            </svg>\n            <span>${t.readTime}</span>\n          </div>\n          \n          <div class="meta-item">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>\n            </svg>\n            <span>${t.views}</span>\n          </div>\n        </div>\n      </div>\n    `,e.addEventListener("click",()=>{this.navigateToPost(t)}),e}formatDate(t){const e=new Date(t),o=new Date,s=Math.abs(o-e),n=Math.ceil(s/864e5);if(1===n)return"昨天";if(n<7)return`${n} 天前`;if(n<30){return`${Math.floor(n/7)} 周前`}return e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}navigateToPost(t){const e=document.querySelector(`[data-post-id="${t.id}"]`);e&&(e.style.transform="scale(0.98)",setTimeout(()=>{e.style.transform=""},150)),setTimeout(()=>{window.location.href=`/posts/${t.id}`},200)}animatePostsAppearance(){this.container.querySelectorAll(".related-post-card").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.transition="all 0.5s ease",t.style.opacity="1",t.style.transform="translateY(0)"},100*e)})}showErrorMessage(){const t=this.container.querySelector(".related-posts-grid");t&&(t.innerHTML='\n      <div class="col-span-full text-center py-12">\n        <div class="text-base-content/60 mb-4">\n          <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n          </svg>\n          <p class="text-lg font-medium">暂时无法加载相关文章</p>\n          <p class="text-sm mt-2">请稍后再试</p>\n        </div>\n        <button class="btn btn-primary btn-sm" onclick="location.reload()">\n          重新加载\n        </button>\n      </div>\n    ')}}class s{constructor(){this.container=null,this.commentForm=null,this.commentsList=null,this.comments=[],this.replyingTo=null,this.init()}init(){this.container=document.querySelector(".comments-section"),this.container&&(this.commentForm=this.container.querySelector(".comment-form"),this.commentsList=this.container.querySelector(".comments-list"),this.bindEvents(),this.loadComments())}bindEvents(){if(this.commentForm){this.commentForm.addEventListener("submit",t=>{t.preventDefault(),this.handleCommentSubmit(t)});const t=this.commentForm.querySelector('textarea[name="content"]');t&&t.addEventListener("input",()=>{this.updateCharacterCount(t)})}}async loadComments(){try{this.comments=this.generateMockComments(),this.renderComments()}catch(t){console.error("加载评论失败:",t),this.showErrorMessage()}}generateMockComments(){return[{id:"comment-1",author:{name:"张三",avatar:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=professional%20developer%20avatar%20friendly%20smile%20portrait&image_size=square",website:"https://zhangsan.dev",isAuthor:!1},content:"这篇文章写得非常好！特别是关于 TypeScript 高级类型的部分，让我学到了很多新知识。希望能看到更多这样的深度技术文章。",publishTime:"2024-01-15T10:30:00Z",likes:12,isLiked:!1,replies:[{id:"reply-1",author:{name:"博主",avatar:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=blog%20author%20professional%20headshot%20confident%20smile&image_size=square",website:null,isAuthor:!0},content:"感谢你的支持！我会继续分享更多实用的技术内容。",publishTime:"2024-01-15T11:15:00Z",likes:3,isLiked:!1,replyTo:"comment-1"}]},{id:"comment-2",author:{name:"李四",avatar:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=female%20developer%20avatar%20professional%20portrait%20glasses&image_size=square",website:null,isAuthor:!1},content:"代码示例很清晰，但是我在实际项目中遇到了一些兼容性问题，能否分享一下解决方案？",publishTime:"2024-01-15T14:20:00Z",likes:5,isLiked:!0,replies:[]}]}renderComments(){this.commentsList&&(this.commentsList.innerHTML="",0!==this.comments.length?(this.comments.forEach(t=>{const e=this.createCommentElement(t);this.commentsList.appendChild(e)}),this.updateCommentsCount()):this.showEmptyState())}createCommentElement(t){const e=document.createElement("article");return e.className="comment-item",e.dataset.commentId=t.id,e.innerHTML=`\n      <div class="comment-avatar">\n        <img src="${t.author.avatar}" alt="${t.author.name}" class="avatar" />\n      </div>\n      \n      <div class="comment-content">\n        <div class="comment-header">\n          <div class="comment-author">\n            ${t.author.website?`<a href="${t.author.website}" target="_blank" rel="noopener" class="author-name">${t.author.name}</a>`:`<span class="author-name">${t.author.name}</span>`}\n            ${t.author.isAuthor?'<span class="author-badge">作者</span>':""}\n          </div>\n          \n          <div class="comment-meta">\n            <time class="comment-time" datetime="${t.publishTime}">\n              ${this.formatTime(t.publishTime)}\n            </time>\n          </div>\n        </div>\n        \n        <div class="comment-body">\n          <p>${t.content}</p>\n        </div>\n        \n        <div class="comment-actions">\n          <button class="action-btn like-btn ${t.isLiked?"liked":""}" data-comment-id="${t.id}">\n            <svg class="w-4 h-4" fill="${t.isLiked?"currentColor":"none"}" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>\n            </svg>\n            <span class="like-count">${t.likes}</span>\n          </button>\n          \n          <button class="action-btn reply-btn" data-comment-id="${t.id}">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>\n            </svg>\n            回复\n          </button>\n        </div>\n        \n        ${t.replies&&t.replies.length>0?this.createRepliesHTML(t.replies):""}\n      </div>\n    `,this.bindCommentEvents(e),e}createRepliesHTML(t){return`<div class="replies-list">${t.map(t=>`\n      <article class="reply-item" data-reply-id="${t.id}">\n        <div class="comment-avatar">\n          <img src="${t.author.avatar}" alt="${t.author.name}" class="avatar" />\n        </div>\n        \n        <div class="comment-content">\n          <div class="comment-header">\n            <div class="comment-author">\n              ${t.author.website?`<a href="${t.author.website}" target="_blank" rel="noopener" class="author-name">${t.author.name}</a>`:`<span class="author-name">${t.author.name}</span>`}\n              ${t.author.isAuthor?'<span class="author-badge">作者</span>':""}\n            </div>\n            \n            <div class="comment-meta">\n              <time class="comment-time" datetime="${t.publishTime}">\n                ${this.formatTime(t.publishTime)}\n              </time>\n            </div>\n          </div>\n          \n          <div class="comment-body">\n            <p>${t.content}</p>\n          </div>\n          \n          <div class="comment-actions">\n            <button class="action-btn like-btn ${t.isLiked?"liked":""}" data-reply-id="${t.id}">\n              <svg class="w-4 h-4" fill="${t.isLiked?"currentColor":"none"}" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>\n              </svg>\n              <span class="like-count">${t.likes}</span>\n            </button>\n          </div>\n        </div>\n      </article>\n    `).join("")}</div>`}bindCommentEvents(t){const e=t.querySelector(".like-btn");e&&e.addEventListener("click",t=>{this.handleLike(t.target.closest(".like-btn"))});const o=t.querySelector(".reply-btn");o&&o.addEventListener("click",t=>{this.handleReply(t.target.closest(".reply-btn"))})}async handleCommentSubmit(t){const e=new FormData(t.target),o={author:e.get("author"),email:e.get("email"),website:e.get("website"),content:e.get("content"),replyTo:this.replyingTo};if(this.validateCommentData(o))try{this.showSubmittingState(),await this.submitComment(o),this.resetCommentForm(),await this.loadComments(),this.showSuccessMessage("评论提交成功！")}catch(s){console.error("提交评论失败:",s),this.showErrorMessage("评论提交失败，请稍后再试")}finally{this.hideSubmittingState()}}validateCommentData(t){return t.author&&0!==t.author.trim().length?t.email&&this.isValidEmail(t.email)?t.content&&0!==t.content.trim().length?!(t.content.length>1e3)||(this.showValidationError("评论内容不能超过1000个字符"),!1):(this.showValidationError("请输入评论内容"),!1):(this.showValidationError("请输入有效的邮箱地址"),!1):(this.showValidationError("请输入您的姓名"),!1)}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}async handleLike(t){const e=t.dataset.commentId||t.dataset.replyId,o=t.classList.contains("liked"),s=t.querySelector(".like-count"),n=parseInt(s.textContent);try{t.classList.toggle("liked"),s.textContent=o?n-1:n+1,await this.toggleLike(e,!o)}catch(i){t.classList.toggle("liked"),s.textContent=n,console.error("点赞操作失败:",i)}}handleReply(t){const e=t.dataset.commentId;this.replyingTo=e,this.commentForm.scrollIntoView({behavior:"smooth"});const o=this.commentForm.querySelector('textarea[name="content"]');o&&o.focus(),this.showReplyIndicator(e)}showReplyIndicator(t){const e=this.commentForm.querySelector(".reply-indicator");e&&e.remove();const o=document.createElement("div");o.className="reply-indicator",o.innerHTML=`\n      <span>正在回复评论 #${t}</span>\n      <button type="button" class="cancel-reply-btn">\n        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n        </svg>\n      </button>\n    `,o.querySelector(".cancel-reply-btn").addEventListener("click",()=>{this.cancelReply()}),this.commentForm.insertBefore(o,this.commentForm.firstChild)}cancelReply(){this.replyingTo=null;const t=this.commentForm.querySelector(".reply-indicator");t&&t.remove()}updateCharacterCount(t){const e=t.value.length,o=this.commentForm.querySelector(".char-counter");o&&(o.textContent=`${e}/1000`,o.classList.toggle("text-error",e>1e3))}formatTime(t){const e=new Date(t),o=new Date,s=Math.abs(o-e),n=Math.ceil(s/6e4),i=Math.ceil(s/36e5),r=Math.ceil(s/864e5);return n<60?`${n} 分钟前`:i<24?`${i} 小时前`:r<7?`${r} 天前`:e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}updateCommentsCount(){const t=this.comments.reduce((t,e)=>t+1+(e.replies?e.replies.length:0),0),e=document.querySelector(".comments-count");e&&(e.textContent=t)}showEmptyState(){this.commentsList.innerHTML='\n      <div class="comments-empty">\n        <svg class="w-16 h-16 mx-auto mb-4 text-base-content/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>\n        </svg>\n        <p class="text-base-content/60 text-center">还没有评论，来发表第一个评论吧！</p>\n      </div>\n    '}showErrorMessage(t="加载评论失败"){console.error(t)}showSuccessMessage(t){console.log(t)}showValidationError(t){alert(t)}showSubmittingState(){const t=this.commentForm.querySelector('button[type="submit"]');t&&(t.disabled=!0,t.textContent="提交中...")}hideSubmittingState(){const t=this.commentForm.querySelector('button[type="submit"]');t&&(t.disabled=!1,t.textContent="发表评论")}resetCommentForm(){this.commentForm.reset(),this.cancelReply();const t=this.commentForm.querySelector(".char-counter");t&&(t.textContent="0/1000",t.classList.remove("text-error"))}async submitComment(t){return new Promise(e=>{setTimeout(()=>{console.log("提交评论:",t),e({success:!0})},1e3)})}async toggleLike(t,e){return console.log(`切换评论 ${t} 的点赞状态为: ${e}`),new Promise(o=>{setTimeout(()=>{console.log((e?"点赞":"取消点赞")+" 评论:",t),o({success:!0})},300)})}}document.addEventListener("DOMContentLoaded",()=>{new t,new e,new o,new s,console.log("文章页面初始化完成")}),window.PostPageManager=t,window.PostLazyImageLoader=e,window.PostRelatedPostsManager=o,window.PostCommentsManager=s;
