<!-- 瞬间说说模块 - 集成插件支持 -->
<div class="absolute bottom-20 left-1/2 transform -translate-x-1/2 z-30 w-full max-w-7xl px-4"
    th:if="${theme.config.index.moment_settings.show_moment}">

    <!-- 未安装插件时的简单提醒 -->
    <th:block th:unless="${pluginFinder.available('PluginMoments')}">
        <div class="moment-card moment-card-with-glow shadow-2xl rounded-2xl border border-blue-500/30 backdrop-blur-sm "
            onmousemove="handleMomentCardGlow(event, this)" onmouseenter="showMomentCardGlow(this)"
            onmouseleave="hideMomentCardGlow(this)">
            <!-- 发光效果容器 -->
            <div class="moment-glow-container">
                <div class="moment-glow"></div>
            </div>
            <div class="p-4 lg:p-6 text-center">
                <p class="text-gray-300 mb-4">需要安装瞬间插件来展示动态内容</p>
                <a href="https://github.com/halo-sigs/plugin-moments" target="_blank"
                    class="inline-flex items-center space-x-2 px-4 py-2 bg-primary/20 border border-primary/30 rounded-lg transition-all duration-200 text-primary">
                    <span class="icon-[material-symbols--download] w-4 h-4"></span>
                    <span>下载瞬间插件</span>
                </a>
            </div>
        </div>
    </th:block>

    <!-- 已安装插件时显示完整功能 -->
    <th:block th:if="${pluginFinder.available('PluginMoments')}">
        <div class="moment-card moment-card-with-glow shadow-2xl rounded-2xl border border-blue-500/30 backdrop-blur-sm"
            onmousemove="handleMomentCardGlow(event, this)" onmouseenter="showMomentCardGlow(this)"
            onmouseleave="hideMomentCardGlow(this)">
            <!-- 发光效果容器 -->
            <div class="moment-glow-container">
                <div class="moment-glow"></div>
            </div>
            <div class="moment-card-content p-4 lg:p-6">
                <!-- 标题栏 - 简约图标风格 -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-2">
                        <span class="bg-primary icon-[material-symbols--chat-rounded] w-5 h-5"></span>
                        <h3 class="text-lg lg:text-xl text-white font-bold  bg-clip-text bg-gradient-to-r from-blue-300 to-purple-400"
                            th:text="${theme.config.index.moment_settings.moment_title ?: '瞬间'}">瞬间</h3>

                    </div>
                    <!-- 发布瞬间按钮 - 仅登录用户可见 -->
                    <button th:if="${#authorization.expression('isAuthenticated()')}"
                        onclick="document.getElementById('talk-modal').classList.remove('hidden'); document.getElementById('talk-modal').style.display = 'flex';"
                        class="p-2 hover:scale-110 transition-all duration-200 group" title="发布瞬间">
                        <span
                            class="icon-[material-symbols--add] w-5 h-5 text-white/70 group-hover:text-green-400 transition-colors"></span>
                    </button>
                    <!-- 查看全部按钮 - 未登录用户显示 -->
                    <a th:unless="${#authorization.expression('isAuthenticated()')}" href="/moments"
                        class="p-2 hover:scale-110 transition-all duration-200 group" title="查看全部瞬间">
                        <span
                            class="icon-[material-symbols--arrow-forward] w-5 h-5 text-white/70 group-hover:text-blue-400 transition-colors"></span>
                    </a>
                </div>

                <!-- 统一响应式网格布局：PC显示3个，平板显示2个，手机显示1个 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <th:block th:each="moment, momentStat : ${momentFinder.listAll()}"
                        th:with="content=${moment.spec.content}">
                        <!-- 根据索引动态设置响应式显示类 -->
                        <div th:if="${not #strings.isEmpty(content.raw) and momentStat.index < 3}" th:class="${'moment-floating-card shadow-lg rounded-xl p-4 transform hover:rotate-0 text-white transition-all duration-300 hover:shadow-blue-500/10 hover:border-blue-500/30 border border-transparent' + 
                                      (momentStat.index == 1 ? ' hidden md:block' : '') + 
                                      (momentStat.index == 2 ? ' hidden lg:block' : '')}"
                            th:classappend="${momentStat.index % 2 == 0 ? '-rotate-1' : 'rotate-1'}">
                            <a class="line-clamp-1" href>
                                <p th:utext="${content.raw}"></p>
                            </a>

                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="icon-[material-symbols--schedule] w-3.5 h-3.5 text-gray-400"></span>
                                    <span class="text-xs text-gray-400"
                                        th:text="${#temporals.format(moment.spec.releaseTime, 'MM-dd HH:mm')}"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <!-- 点赞数量 -->
                                    <span class="text-xs text-gray-400" th:text="${moment.stats.upvote ?: 0}">0</span>
                                    <!-- 点赞按钮 -->
                                    <button onclick="upvoteMoment(this)" th:data-moment-name="${moment.metadata.name}"
                                        class="p-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 hover:border-red-400/30 transition-all flex items-center space-x-1 group moment-like-btn"
                                        title="点赞">
                                        <span
                                            class="icon-[material-symbols--favorite] w-3.5 h-3.5 text-white/60 group-hover:text-red-400 transition-colors"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>
            </div>
        </div>
    </th:block>
</div>

<!-- 发布瞬间模态框 - 仅登录用户可见 -->
<div id="talk-modal" th:if="${#authorization.expression('isAuthenticated()')}"
    class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[100] items-center justify-center hidden"
    onclick="if(event.target === this) { document.getElementById('talk-modal').classList.add('hidden'); document.getElementById('talk-modal').style.display = 'none'; }"
    style="display: none;">
    <link rel="stylesheet" th:href="@{/assets/emoji/emoji-selector.css?v={version}(version=${theme.spec.version})}">

    <script th:src="@{/assets/emoji/emoji-selector.js?v={version}(version=${theme.spec.version})}"></script>

    <div class="w-full max-w-lg mx-4 bg-base-200 rounded-2xl border border-base-300 shadow-2xl overflow-hidden backdrop-blur-md"
        onclick="event.stopPropagation();">
        <!-- 模态框标题 -->
        <div class="bg-base-300 px-6 py-4 border-b border-base-300 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <span class="icon-[material-symbols--edit] w-5 h-5 text-blue-400"></span>
                <h3 class="text-lg font-bold text-base-content">轻发布</h3>
            </div>
            <button class="p-1.5 text-base-content/60 hover:text-base-content transition-all"
                onclick="document.getElementById('talk-modal').classList.add('hidden'); document.getElementById('talk-modal').style.display = 'none';"
                title="关闭">
                <span class="icon-[material-symbols--close] w-5 h-5"></span>
            </button>
        </div>

        <!-- 模态框内容 -->
        <div class="p-6">
            <form onsubmit="event.preventDefault(); showPublishSuccess();">
                <!-- 文本输入区 -->
                <div class="mb-4">
                    <textarea id="talk-content"
                        class="w-full bg-base-100 border border-base-300 rounded-xl p-4 text-base-content placeholder-base-content/50 focus:border-blue-500/50 focus:ring focus:ring-blue-500/20 transition-all"
                        rows="4" placeholder="分享你的想法..." maxlength="200"
                        oninput="document.getElementById('char-count').textContent = this.value.length + '/200'"></textarea>
                    <div class="flex justify-between items-center text-xs text-base-content/60 mt-2">
                        <!-- 工具栏 -->
                        <div class="flex space-x-2">
                            <!-- 表情选择器按钮 -->
                            <button type="button" id="emoji-trigger-btn"
                                onclick="showEmojiSelector(document.getElementById('talk-content'), this)"
                                class="p-2 hover:scale-110 transition-all duration-200 group" title="添加表情">
                                <span
                                    class="icon-[material-symbols--sentiment-satisfied] w-4 h-4 text-base-content/60 group-hover:text-yellow-400 transition-colors"></span>
                            </button>
                        </div>

                        <!-- 字数统计 -->
                        <span id="char-count">0/200</span>
                    </div>
                </div>

                <!-- 提交按钮 -->
                <div class="flex justify-end">
                    <button type="submit" id="publish-btn"
                        class="p-2.5 hover:scale-110 transition-all duration-200 group" title="发布">
                        <span
                            class="icon-[material-symbols--send] w-5 h-5 text-base-content/60 group-hover:text-blue-400 transition-colors"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>